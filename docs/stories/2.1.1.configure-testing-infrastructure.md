# <!-- Powered by BMADâ„¢ Core -->

# Story 2.1.1: Configure Testing Infrastructure

## Status
**Ready for Review**

## Story
**As a** developer,
**I want** to have a properly configured testing infrastructure with Vitest and React Testing Library,
**so that** I can write and run automated tests for React components and unblock Story 2.1.

**Critical Context:** This story unblocks Story 2.1. The developer skipped all testing tasks because the project's testing infrastructure (Vitest + React Testing Library) was never set up.

## Acceptance Criteria

1. **Testing Dependencies Installed:** All required testing packages are installed via npm (Vitest, @vitest/ui, jsdom, @testing-library/react, @testing-library/jest-dom).
2. **Vite Configuration Updated:** `vite.config.js` contains proper Vitest test configuration including test environment setup.
3. **Test Setup File Created:** A setup file (e.g., `src/setupTests.js`) exists and imports @testing-library/jest-dom matchers.
4. **Smoke Test Exists:** At least one working test file (e.g., `src/App.test.jsx`) demonstrates the test infrastructure works.
5. **Test Command Works:** Running `npm run test` executes the test suite and passes successfully.
6. **Test Coverage Command Works:** Running test coverage reports work correctly.

## Tasks / Subtasks

- [x] **Task 1: Install Testing Dependencies** (AC: 1)
  - [x] Run `npm install -D vitest @vitest/ui jsdom`
  - [x] Run `npm install -D @testing-library/react @testing-library/jest-dom @testing-library/user-event`
  - [x] Verify all packages appear in `package.json` devDependencies

- [x] **Task 2: Update Vite Configuration** (AC: 2)
  - [x] Open `vite.config.js`
  - [x] Add test configuration block with jsdom environment
  - [x] Configure globals for test environment
  - [x] Set up test include/exclude patterns
  - [x] Configure coverage provider and reporters

- [x] **Task 3: Create Test Setup File** (AC: 3)
  - [x] Create `src/setupTests.js`
  - [x] Import `@testing-library/jest-dom/vitest` for DOM matchers
  - [x] Add any global test configuration needed

- [x] **Task 4: Add Test Scripts to package.json** (AC: 5)
  - [x] Add `"test": "vitest"` script
  - [x] Add `"test:ui": "vitest --ui"` script for Vitest UI
  - [x] Add `"test:coverage": "vitest --coverage"` script
  - [x] Add `"test:run": "vitest run"` script for CI/single-run mode

- [x] **Task 5: Create Smoke Test** (AC: 4)
  - [x] Create `src/App.test.jsx`
  - [x] Write simple test that renders App component
  - [x] Add assertion to verify component renders without crashing
  - [x] Verify test can import and use @testing-library/react utilities

- [x] **Task 6: Verify Test Infrastructure** (AC: 5, 6)
  - [x] Run `npm run test` and confirm test executes
  - [x] Verify smoke test passes
  - [x] Run `npm run test:coverage` and confirm coverage report generates
  - [x] Verify no errors in test output

## Dev Notes

### Recommended Vite Configuration

Add this to `vite.config.js`:

```javascript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/setupTests.js',
    css: true,
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/setupTests.js',
      ]
    }
  }
});
```

### Test Setup File

Create `src/setupTests.js`:

```javascript
import { expect, afterEach } from 'vitest';
import { cleanup } from '@testing-library/react';
import * as matchers from '@testing-library/jest-dom/matchers';

expect.extend(matchers);

// Cleanup after each test
afterEach(() => {
  cleanup();
});
```

### Example Smoke Test

Create `src/App.test.jsx`:

```javascript
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import App from './App';

describe('App', () => {
  it('renders without crashing', () => {
    render(
      <BrowserRouter>
        <App />
      </BrowserRouter>
    );

    // Simple assertion - just verify it rendered
    expect(document.body).toBeTruthy();
  });
});
```

### Testing Best Practices

Reference: Testing best practices for React applications

**Key Principles:**
- Test behavior, not implementation
- Use semantic queries (getByRole, getByLabelText) over test IDs
- Write tests that resemble how users interact with the app
- Mock external dependencies (Firestore, auth) at the boundary

**File Naming Conventions:**
- Unit tests: `ComponentName.test.jsx`
- Integration tests: `FeatureName.integration.test.jsx`
- Test files should be co-located with components or in `__tests__` folders

**Common Patterns:**
```javascript
// Wrapping components that need providers
const renderWithProviders = (component) => {
  return render(
    <AuthProvider>
      <BrowserRouter>
        {component}
      </BrowserRouter>
    </AuthProvider>
  );
};

// Mocking Firestore
vi.mock('./config/firebase', () => ({
  db: {},
  auth: {},
}));
```

### Testing

**Validation Steps:**
1. Run `npm run test` - should execute and pass
2. Run `npm run test:ui` - should open Vitest UI in browser
3. Run `npm run test:coverage` - should generate coverage report
4. Run `npm run test:run` - should run tests once and exit (CI mode)

**Success Criteria:**
- All test commands work without errors
- Smoke test passes
- Coverage report generates successfully
- No console errors or warnings during test execution

**Manual Testing Checklist:**
- [ ] Test infrastructure installed successfully
- [ ] Smoke test runs and passes
- [ ] Test UI accessible and functional
- [ ] Coverage reports generate correctly
- [ ] Test watch mode works (reruns on file changes)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-19 | 1.0 | Initial story creation - Testing Infrastructure Setup (Unblocks Story 2.1) | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
None - no blocking issues encountered

### Completion Notes List
- Successfully installed all testing dependencies (7 packages total)
- Configured Vite with test environment and coverage settings
- Created test setup file with jest-dom matchers
- Added 4 test scripts to package.json
- Created smoke test with Firebase mocking
- All tests pass successfully (1 test passing)
- Coverage reports generate correctly
- Additional coverage package @vitest/coverage-v8 installed to support coverage commands

### File List
**New Files Created:**
- src/setupTests.js (test setup with jest-dom matchers)
- src/App.test.jsx (smoke test with mocked Firebase dependencies)

**Modified Files:**
- vite.config.js (added test configuration block)
- package.json (added 4 test scripts + 7 testing dependencies)

## QA Results
*To be populated by QA agent*
